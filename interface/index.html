<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>High-level Interface · Augmentor.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../assets/style.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><a href="../index.html"><img class="logo" src="../assets/logo.png" alt="Augmentor.jl logo"/></a><h1>Augmentor.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li><a class="toctext" href="../gettingstarted/">Getting Started</a></li><li><span class="toctext">Introduction and Motivation</span><ul><li><a class="toctext" href="../background/">Background and Motivation</a></li><li><a class="toctext" href="../images/">Working with Images in Julia</a></li></ul></li><li><span class="toctext">User&#39;s Guide</span><ul><li class="current"><a class="toctext" href>High-level Interface</a><ul class="internal"><li><a class="toctext" href="#pipeline-1">Defining a Pipeline</a></li><li><a class="toctext" href="#Loading-the-Example-Image-1">Loading the Example Image</a></li><li><a class="toctext" href="#Augmenting-an-Image-1">Augmenting an Image</a></li><li><a class="toctext" href="#Augmenting-Image-Batches-1">Augmenting Image Batches</a></li></ul></li><li><a class="toctext" href="../operations/">Supported Operations</a></li></ul></li><li><span class="toctext">Tutorials</span><ul><li><a class="toctext" href="../generated/mnist_elastic/">MNIST: Elastic Distortions</a></li><li><a class="toctext" href="../generated/mnist_knet/">MNIST: Knet.jl CNN</a></li></ul></li><li><a class="toctext" href="../LICENSE/">LICENSE</a></li></ul></nav><article id="docs"><header><nav><ul><li>User&#39;s Guide</li><li><a href>High-level Interface</a></li></ul><a class="edit-page" href="https://github.com/Evizero/Augmentor.jl/blob/master/docs/src/interface.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>High-level Interface</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="High-level-Interface-1" href="#High-level-Interface-1">High-level Interface</a></h1><p>Integrating Augmentor into an existing project should in general not require any major changes to your code. In most cases it should break down to the three basic steps outlined below. We will spend the rest of this document investigating these in more detail.</p><ol><li><p>Import Augmentor into the namespace of your program.</p><pre><code class="language-julia">using Augmentor</code></pre></li><li><p>Define a (stochastic) image processing pipeline by chaining the desired <a href="../operations/#operations-1">operations</a> using <code>|&gt;</code> and <code>*</code>.</p><pre><code class="language-julia-repl">julia&gt; pl = FlipX() * FlipY() |&gt; Zoom(0.9:0.1:1.2) |&gt; CropSize(64,64)
3-step Augmentor.ImmutablePipeline:
 1.) Either: (50%) Flip the X axis. (50%) Flip the Y axis.
 2.) Zoom by I ∈ {0.9×0.9, 1.0×1.0, 1.1×1.1, 1.2×1.2}
 3.) Crop a 64×64 window around the center</code></pre></li><li><p>Apply the pipeline to the existing image or set of images.</p><pre><code class="language-julia">img_processed = augment(img_original, pl)</code></pre></li></ol><p>Depending on the complexity of your problem, you may want to iterate between <code>2.</code> and <code>3.</code> to identify an appropriate pipeline. Take a look at the <a href="../generated/mnist_elastic/#elastic-1">Elastic Distortions Tutorial</a> for an example of how such an iterative process could look like.</p><h2><a class="nav-anchor" id="pipeline-1" href="#pipeline-1">Defining a Pipeline</a></h2><p>In Augmentor, a (stochastic) image-processing pipeline can be understood as a sequence of operations, for which the parameters can (but need not) be random variables. What that essentially means is that the user explicitly specifies which image operation to perform in what order. A complete list of available operations can be found at <a href="../operations/#operations-1">Supported Operations</a>.</p><p>To start off with a simple example, let us assume that we want to first rotate our image(s) counter-clockwise by 14°, then crop them down to the biggest possible square, and lastly resize the image(s) to a fixed size of 64 by 64 pixel. Such a pipeline would be defined as follows:</p><pre><code class="language-julia-repl">julia&gt; pl = Rotate(14) |&gt; CropRatio(1) |&gt; Resize(64,64)
3-step Augmentor.ImmutablePipeline:
 1.) Rotate 14 degree
 2.) Crop to 1:1 aspect ratio
 3.) Resize to 64×64</code></pre><p>Notice that in the example above there is no room for randomness. In other words, the same input image would always result in the same output image given that pipeline. If we wish for more variation we can do so by using a vector as our parameters, instead of a single number.</p><div class="admonition note"><div class="admonition-title">Note</div><div class="admonition-text"><p>In this subsection we will focus only on how to define a pipeline, without actually thinking too much about how to apply that pipeline to an actual image. The later will be the main topic of the rest of this document.</p></div></div><p>Say we wish to adapt our pipeline such that the rotation is a little more random. More specifically, lets say we want our image to be rotated by either -10°, -5°, 5°, 10°, or not at all. Other than that change we will leave the rest of the pipeline as is.</p><pre><code class="language-julia-repl">julia&gt; pl = Rotate([-10,-5,0,5,10]) |&gt; CropRatio(1) |&gt; Resize(64,64)
3-step Augmentor.ImmutablePipeline:
 1.) Rotate by θ ∈ [-10, -5, 0, 5, 10] degree
 2.) Crop to 1:1 aspect ratio
 3.) Resize to 64×64</code></pre><p>Variation in the parameters is only one of the two main ways to introduce randomness to our pipeline. Additionally, one can specify that an operation should be sampled randomly from a chosen set of operations . This can be accomplished using a utility operation called <a href="../operations/either/#Augmentor.Either"><code>Either</code></a>, which has its own convenience syntax.</p><p>As an example, let us assume we wish to first either mirror our image(s) horizontally, or vertically, or not at all, and then crop it down to a size of 100 by 100 pixel around the image&#39;s center. We can specify the &quot;either&quot; using the <code>*</code> operator.</p><pre><code class="language-julia-repl">julia&gt; pl = FlipX() * FlipY() * NoOp() |&gt; CropSize(100,100)
2-step Augmentor.ImmutablePipeline:
 1.) Either: (33%) Flip the X axis. (33%) Flip the Y axis. (33%) No operation.
 2.) Crop a 100×100 window around the center</code></pre><p>It is also possible to specify the odds of for such an &quot;either&quot;. For example we may want the <a href="../operations/noop/#Augmentor.NoOp"><code>NoOp</code></a> to be twice as likely as either of the mirroring options.</p><pre><code class="language-julia-repl">julia&gt; pl = (1=&gt;FlipX()) * (1=&gt;FlipY()) * (2=&gt;NoOp()) |&gt; CropSize(100,100)
2-step Augmentor.ImmutablePipeline:
 1.) Either: (25%) Flip the X axis. (25%) Flip the Y axis. (50%) No operation.
 2.) Crop a 100×100 window around the center</code></pre><p>Now that we know how to define a pipeline, let us think about how to apply it to an image or a set of images.</p><h2><a class="nav-anchor" id="Loading-the-Example-Image-1" href="#Loading-the-Example-Image-1">Loading the Example Image</a></h2><p>Augmentor ships with a custom example image, which was specifically designed for visualizing augmentation effects. It can be accessed by calling the function <code>testpattern()</code>. That said, doing so explicitly should rarely be necessary in practice, because most high-level functions will default to using <code>testpattern()</code> if no other image is specified.</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Augmentor.testpattern" href="#Augmentor.testpattern"><code>Augmentor.testpattern</code></a> — <span class="docstring-category">Function</span>.</div><div><pre><code class="language-none">testpattern() -&gt; Matrix{RGBA{N0f8}}</code></pre><p>Load and return the provided 300x400 test image.</p><p>The returned image was specifically designed to be informative about the effects of the applied augmentation operations. It is thus well suited to prototype an augmentation pipeline, because it makes it easy to see what kind of effects one can achieve with it.</p></div><a class="source-link" target="_blank" href="https://github.com/Evizero/Augmentor.jl/blob/1f7a5bcf424683f93409b9097ca798eeecf33785/src/utils.jl#L1-L10">source</a></section><div><pre><code class="language-julia">using Augmentor
img = testpattern()</code></pre></div><p><img src="../assets/big_pattern.png" alt="testpattern"/></p><h2><a class="nav-anchor" id="Augmenting-an-Image-1" href="#Augmenting-an-Image-1">Augmenting an Image</a></h2><p>Once a pipeline is constructed it can be applied to an image (i.e. <code>AbstractArray{&lt;:ColorTypes.Colorant}</code>), or even just to an array of numbers (i.e. <code>AbstractArray{&lt;:Number}</code>), using the function <code>augment</code>.</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Augmentor.augment" href="#Augmentor.augment"><code>Augmentor.augment</code></a> — <span class="docstring-category">Function</span>.</div><div><pre><code class="language-none">augment([img], pipeline) -&gt; imga</code></pre><p>Apply the operations of the given <code>pipeline</code> to the image <code>img</code> and return the resulting image <code>imga</code>.</p><p>The parameter <code>pipeline</code> can be a <code>Augmentor.Pipeline</code>, a tuple of <code>Augmentor.Operation</code>, or a single <code>Augmentor.Operation</code>.</p><pre><code class="language-julia">img = testpattern()
augment(img, FlipX() |&gt; FlipY())
augment(img, (FlipX(), FlipY()))
augment(img, FlipX())</code></pre><p>If <code>img</code> is omitted, Augmentor will use the augmentation test image provided by the function <a href="#Augmentor.testpattern"><code>testpattern</code></a> as the input image.</p><pre><code class="language-julia">augment(FlipX())</code></pre></div><a class="source-link" target="_blank" href="https://github.com/Evizero/Augmentor.jl/blob/1f7a5bcf424683f93409b9097ca798eeecf33785/src/augment.jl#L1-L24">source</a></section><p>We also provide a mutating version of <code>augment</code> that writes the output into preallocated memory. While this function avoids allocation, it does have the caveat that the size of the output image must be known beforehand (and thus must not be random).</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Augmentor.augment!" href="#Augmentor.augment!"><code>Augmentor.augment!</code></a> — <span class="docstring-category">Function</span>.</div><div><pre><code class="language-none">augment!(out, img, pipeline) -&gt; out</code></pre><p>Apply the operations of the given <code>pipeline</code> to the image <code>img</code> and write the resulting image into <code>out</code>.</p><p>The parameter <code>pipeline</code> can be a <code>Augmentor.Pipeline</code>, a tuple of <code>Augmentor.Operation</code>, or a single <code>Augmentor.Operation</code>.</p><pre><code class="language-julia">img = testpattern()
out = similar(img)
augment!(out, img, FlipX() |&gt; FlipY())
augment!(out, img, (FlipX(), FlipY()))
augment!(out, img, FlipX())</code></pre></div><a class="source-link" target="_blank" href="https://github.com/Evizero/Augmentor.jl/blob/1f7a5bcf424683f93409b9097ca798eeecf33785/src/augment.jl#L51-L67">source</a></section><h2><a class="nav-anchor" id="Augmenting-Image-Batches-1" href="#Augmenting-Image-Batches-1">Augmenting Image Batches</a></h2><p>In most machine learning scenarios we will want to process a whole batch of images at once, instead of a single image at a time. For this reason we provide the function <code>augmentbatch!</code>, which also supports multi-threading.</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Augmentor.augmentbatch!" href="#Augmentor.augmentbatch!"><code>Augmentor.augmentbatch!</code></a> — <span class="docstring-category">Function</span>.</div><div><pre><code class="language-none">augmentbatch!([resource], outs, imgs, pipeline, [obsdim]) -&gt; outs</code></pre><p>Apply the operations of the given <code>pipeline</code> to the images in <code>imgs</code> and write the resulting images into <code>outs</code>.</p><p>Both <code>outs</code> and <code>imgs</code> have to contain the same number of images. Each of these two variables can either be in the form of a higher dimensional array, or alternatively in the form of a vector of arrays, for which each vector element denotes an image.</p><p>If one (or both) of the two parameters <code>outs</code> and <code>imgs</code> is a higher dimensional array, then the optional parameter <code>obsdim</code> can be used specify which dimension denotes the observations (defaults to <code>ObsDim.Last()</code>),</p><p>The parameter <code>pipeline</code> can be a <code>Augmentor.Pipeline</code>, a tuple of <code>Augmentor.Operation</code>, or a single <code>Augmentor.Operation</code>.</p><p>The optional first parameter <code>resource</code> can either be <code>CPU1()</code> (default) or <code>CPUThreads()</code>. In the later case the images will be augmented in parallel. For this to make sense make sure that the environment variable <code>JULIA_NUM_THREADS</code> is set to a reasonable number so that <code>Threads.nthreads()</code> is greater than 1.</p></div><a class="source-link" target="_blank" href="https://github.com/Evizero/Augmentor.jl/blob/1f7a5bcf424683f93409b9097ca798eeecf33785/src/augmentbatch.jl#L8-L32">source</a></section><footer><hr/><a class="previous" href="../images/"><span class="direction">Previous</span><span class="title">Working with Images in Julia</span></a><a class="next" href="../operations/"><span class="direction">Next</span><span class="title">Supported Operations</span></a></footer></article></body></html>

<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>MNIST: Elastic Distortions · Augmentor.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/><link href="../../assets/favicon.ico" rel="shortcut icon" type="image/x-icon"/><link href="../../assets/style.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><a href="../../index.html"><img class="logo" src="../../assets/logo.png" alt="Augmentor.jl logo"/></a><h1>Augmentor.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><a class="toctext" href="../../gettingstarted/">Getting Started</a></li><li><span class="toctext">Introduction and Motivation</span><ul><li><a class="toctext" href="../../background/">Background and Motivation</a></li><li><a class="toctext" href="../../images/">Working with Images in Julia</a></li></ul></li><li><span class="toctext">User&#39;s Guide</span><ul><li><a class="toctext" href="../../interface/">High-level Interface</a></li><li><a class="toctext" href="../../operations/">Supported Operations</a></li></ul></li><li><span class="toctext">Tutorials</span><ul><li class="current"><a class="toctext" href>MNIST: Elastic Distortions</a><ul class="internal"><li><a class="toctext" href="#Loading-the-MNIST-Trainingset-1">Loading the MNIST Trainingset</a></li><li><a class="toctext" href="#Visualizing-Distortion-Effects-1">Visualizing Distortion Effects</a></li><li><a class="toctext" href="#References-1">References</a></li></ul></li></ul></li><li><a class="toctext" href="../../LICENSE/">LICENSE</a></li></ul></nav><article id="docs"><header><nav><ul><li>Tutorials</li><li><a href>MNIST: Elastic Distortions</a></li></ul><a class="edit-page" href="https://github.com/Evizero/Augmentor.jl/tree/284e042855436629112a3c0ef4e562942b17c1f2/docs/src/generated/mnist_elastic.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>MNIST: Elastic Distortions</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="MNIST:-Elastic-Distortions-1" href="#MNIST:-Elastic-Distortions-1">MNIST: Elastic Distortions</a></h1><p>In this example we are going to use <code>Augmentor.jl</code> on the famous <strong>MNIST database of handwritten digits</strong> <a href="#footnote-MNIST1998">[MNIST1998]</a> to reproduce the elastic distortions discussed in <a href="#footnote-SIMARD2003">[SIMARD2003]</a>.</p><p>Note that the way Augmentor implements deformations is a little different than how it is described by the authors in the paper. This is for a couple of reasons, most notably that we want the parameters for our deformations to be intepended of the size of image it is applied on. As a consequence the parameter numbers specified in the paper are not 1-to-1 transferable to Augmentor.</p><h2><a class="nav-anchor" id="Loading-the-MNIST-Trainingset-1" href="#Loading-the-MNIST-Trainingset-1">Loading the MNIST Trainingset</a></h2><p>In order to access and visualize the MNIST images we employ the help of two additional Julia packages.</p><ul><li><p><a href="https://github.com/JuliaImages/Images.jl">Images.jl</a> will provide us with the tool for working with image data in Julia.</p></li><li><p><a href="https://github.com/JuliaML/MLDatasets.jl">MLDatasets.jl</a> has an MNIST submodule that offers a convenience interface to read the MNIST database.</p></li></ul><p>The function <code>MNIST.traintensor</code> returns the MNIST training images corresponding to the given indices as a multi-dimensional array. These images are stored in the native horizontal-major memory layout as a single floating point array, where all values are scaled to be between 0.0 and 1.0.</p><div><pre><code class="language-julia">using Images, MLDatasets
train_tensor = MNIST.traintensor()
@show summary(train_tensor)</code></pre><pre><code class="language-none">summary(train_tensor) = &quot;28×28×60000 Array{Float64,3}&quot;</code></pre></div><p>This horizontal-major format is the standard way of utilizing this dataset for training machine learning models. In this tutorial, however, we are more interested in working with the MNIST images as actual Julia images in vertical-major layout, and as black digits on white background.</p><p>We can convert the &quot;tensor&quot; to a <code>Colorant</code> array using the provided function <code>MNIST.convert2image</code>.</p><div><pre><code class="language-julia">train_images = MNIST.convert2image(train_tensor)
train_images[:,:,1] # show first image</code></pre></div><p><img src="../mnist_1.png" alt="first image"/></p><h2><a class="nav-anchor" id="Visualizing-Distortion-Effects-1" href="#Visualizing-Distortion-Effects-1">Visualizing Distortion Effects</a></h2><p>Before we apply a smoothed displacement field to our dataset and train a network, we should invest some time to come up with a decent set of hyper parameters for the operation. A useful tool for tasks like this is the package <a href="https://github.com/JuliaGizmos/Interact.jl">Interact.jl</a>.</p><div><pre><code class="language-julia"># These two package will provide us with the capabilities
# to perform interactive visualisations in a jupyter notebook
using Augmentor, Interact, Reactive

# The manipulate macro will turn the parameters of the
# loop into interactive widgets.
@manipulate for
        unpaused = true,
        ticks = fpswhen(signal(unpaused), 5.),
        image_index = 1:100,
        grid_size = 3:20,
        scale = .1:.1:.5,
        sigma = 1:5,
        iterations = 1:6,
        free_border = true
    op = ElasticDistortion(grid_size, grid_size, # equal width &amp; height
                           sigma = sigma,
                           scale = scale,
                           iter = iterations,
                           border = free_border)
    augment(train_images[:, :, image_index], op)
end</code></pre></div><p>Executing the code above in a Juypter notebook will result in the following interactive visualisation. You can now use the sliders to investigate the effects that different parameters have on the MNIST training set.</p><div class="admonition tip"><div class="admonition-title">Tip</div><div class="admonition-text"><p>You should always use your <strong>training</strong> set to do this kind of visualisation (not the test test!). Otherwise you are likely to achieve overly optimistic (i.e. biased) results during training.</p></div></div><p><img src="https://cloud.githubusercontent.com/assets/10854026/17641720/5de6cd8c-612c-11e6-933f-b91d58cf2fde.gif" alt="notebook"/></p><p>Congratulations! With just a few simple lines of code, you created a simple interactive tool to visualize your image augmentation pipeline. Once you found a set of parameters that you think are appropriate for your dataset you can go ahead and train your model.</p><h2><a class="nav-anchor" id="References-1" href="#References-1">References</a></h2><div class="footnote" id="footnote-MNIST1998"><a href="#footnote-MNIST1998"><strong>[MNIST1998]</strong></a><p>LeCun, Yan, Corinna Cortes, Christopher J.C. Burges. <a href="http://yann.lecun.com/exdb/mnist/">&quot;The MNIST database of handwritten digits&quot;</a> Website. 1998.</p></div><div class="footnote" id="footnote-SIMARD2003"><a href="#footnote-SIMARD2003"><strong>[SIMARD2003]</strong></a><p>Simard, Patrice Y., David Steinkraus, and John C. Platt. <a href="https://www.microsoft.com/en-us/research/publication/best-practices-for-convolutional-neural-networks-applied-to-visual-document-analysis/">&quot;Best practices for convolutional neural networks applied to visual document analysis.&quot;</a> ICDAR. Vol. 3. 2003.</p></div><footer><hr/><a class="previous" href="../../operations/either/"><span class="direction">Previous</span><span class="title">Either: Stochastic branches</span></a><a class="next" href="../../indices/"><span class="direction">Next</span><span class="title">Indices</span></a></footer></article></body></html>
